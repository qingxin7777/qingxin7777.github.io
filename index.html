<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å˜‰å†œå…¬å¸ä¿¡æ¯ç®¡ç†ç³»ç»Ÿ</title>
    <!-- å¼•å…¥å›¾æ ‡åº“ï¼ˆå¯†ç æ˜¾ç¤º/éšè—ç”¨ï¼‰ -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* å…¨å±€CSSå˜é‡ - ç»Ÿä¸€ç®¡ç†æ ·å¼ */
        :root {
            /* ä¸»é¢˜è‰² */
            --primary-color: #2d6a4f;
            --primary-light: #40916c;
            --primary-dark: #1b4332;
            --primary-hover: #1f573f;
            --secondary-color: #95d5b2;
            --secondary-light: #b7e4c7;
            /* ä¸­æ€§è‰² */
            --white: #ffffff;
            --gray-50: #f8fdf7;
            --gray-100: #e8f4f8;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-600: #6c757d;
            --gray-700: #34495e;
            /* åŠŸèƒ½è‰² */
            --error-color: #e53e3e;
            /* å¸ƒå±€å˜é‡ */
            --container-width: 450px;
            --form-padding: 45px 40px;
            --mobile-form-padding: 35px 25px;
            --border-radius-lg: 20px;
            --border-radius-md: 12px;
            --border-radius-sm: 8px;
            --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 12px 32px rgba(0, 0, 0, 0.1);
            /* åŠ¨ç”»å˜é‡ */
            --transition-base: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "PingFang SC", "Microsoft Yahei", "Helvetica Neue", sans-serif;
        }

        body {
            /* è”¬èœèƒŒæ™¯å›¾ + åŒå±‚é®ç½©ä¼˜åŒ–è§†è§‰ */
            background: url('https://cdn.pixabay.com/photo/2023/06/12/11/34/mushrooms-8058299_1280.jpg') no-repeat center center fixed;
            background-size: cover;
            position: relative;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* åŒå±‚é®ç½©ï¼šåº•å±‚æ·±è‰²å¼±åŒ–èƒŒæ™¯ï¼Œä¸Šå±‚æµ…è‰²æå‡è¡¨å•å¯è¯»æ€§ */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(45, 106, 79, 0.1);
            z-index: -2;
        }

        body::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.4);
            z-index: -1;
        }

        /* è¡¨å•å®¹å™¨ - è§†è§‰å‡çº§ */
        .form-container {
            width: var(--container-width);
            max-width: 100%;
            background: linear-gradient(180deg, var(--white) 0%, var(--gray-50) 100%);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            border: 1px solid var(--gray-100);
            transition: var(--transition-base);
        }

        .form-container:hover {
            box-shadow: var(--shadow-lg);
        }

        /* è¡¨å•ç›’å­ - å¸ƒå±€é‡æ„ */
        .form-box {
            padding: var(--form-padding);
            display: none;
        }

        .form-box.active {
            display: block;
            animation: fadeIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* æ·¡å…¥åŠ¨ç”»ä¼˜åŒ– */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* è¡¨å•æ ‡é¢˜ - è§†è§‰å¼ºåŒ– */
        .form-header {
            text-align: center;
            margin-bottom: 35px;
        }

        .form-title {
            color: var(--primary-color);
            font-size: 26px;
            font-weight: 700;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .form-subtitle {
            color: var(--gray-600);
            font-size: 14px;
            font-weight: 400;
            line-height: 1.5;
        }

        /* è¡¨å•åˆ†ç»„ - é—´è·ä¼˜åŒ– */
        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        /* æ ‡ç­¾æ ·å¼å‡çº§ */
        .form-label {
            display: block;
            margin-bottom: 10px;
            color: var(--gray-700);
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition-fast);
        }

        /* è¾“å…¥æ¡†å®¹å™¨ - é€‚é…å¯†ç æ˜¾ç¤ºæŒ‰é’® */
        .input-wrapper {
            position: relative;
        }

        /* è¾“å…¥æ¡†/é€‰æ‹©æ¡† - æ ·å¼ç»Ÿä¸€ä¼˜åŒ– */
        .form-input {
            width: 100%;
            padding: 15px 18px;
            border: 1px solid var(--gray-100);
            border-radius: var(--border-radius-md);
            font-size: 15px;
            background: var(--white);
            color: var(--gray-700);
            transition: var(--transition-fast);
            outline: none;
        }

        /* å ä½ç¬¦æ ·å¼ä¼˜åŒ– */
        .form-input::placeholder {
            color: var(--gray-600);
            opacity: 0.7;
            font-size: 14px;
        }

        /* è¾“å…¥æ¡†äº¤äº’æ€ */
        .form-input:focus {
            border-color: var(--primary-light);
            box-shadow: 0 0 0 4px rgba(116, 198, 157, 0.1);
            background: var(--white);
        }

        .form-input:hover {
            border-color: var(--secondary-light);
        }

        /* é€‰æ‹©æ¡†ç‰¹æ®Šæ ·å¼ */
        .form-input select {
            appearance: none;
            background: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E") no-repeat right 18px center;
            padding-right: 45px !important;
        }

        /* å¯†ç æ˜¾ç¤º/éšè—æŒ‰é’® */
        .password-toggle {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: var(--gray-600);
            cursor: pointer;
            font-size: 18px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
        }

        .password-toggle:hover {
            color: var(--primary-color);
        }

        /* é”™è¯¯æç¤º - æ ·å¼å‡çº§ */
        .error-tip {
            height: 22px;
            margin-top: 8px;
            font-size: 12px;
            color: var(--error-color);
            line-height: 22px;
            display: flex;
            align-items: center;
            gap: 6px;
            opacity: 0;
            transform: translateY(5px);
            transition: var(--transition-fast);
        }

        .error-tip.show {
            opacity: 1;
            transform: translateY(0);
        }

        .error-tip::before {
            content: '!';
            display: inline-block;
            width: 18px;
            height: 18px;
            background: var(--error-color);
            color: var(--white);
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 11px;
            font-weight: bold;
        }

        /* æäº¤æŒ‰é’® - è§†è§‰å‡çº§ */
        .submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: var(--white);
            border: none;
            border-radius: var(--border-radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-base);
            margin-top: 10px;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        /* æŒ‰é’®hover/activeæ€ */
        .submit-btn:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-color) 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(45, 106, 79, 0.2);
        }

        .submit-btn:active {
            transform: translateY(0);
            box-shadow: 0 4px 8px rgba(45, 106, 79, 0.2);
        }

        /* æŒ‰é’®ç‚¹å‡»æ³¢çº¹æ•ˆæœï¼ˆè§†è§‰å¢å¼ºï¼‰ */
        .submit-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .submit-btn:active::after {
            width: 300px;
            height: 300px;
            opacity: 0;
        }

        /* è¡¨å•åˆ‡æ¢åŒºåŸŸ - å¸ƒå±€ä¼˜åŒ– */
        .form-switch {
            text-align: center;
            margin-top: 30px;
            font-size: 14px;
            color: var(--gray-600);
            padding-top: 15px;
            border-top: 1px solid var(--gray-100);
        }

        .form-switch a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition-fast);
            position: relative;
        }

        /* åˆ‡æ¢é“¾æ¥ä¸‹åˆ’çº¿åŠ¨ç”» */
        .form-switch a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary-light);
            transition: var(--transition-fast);
        }

        .form-switch a:hover {
            color: var(--primary-dark);
        }

        .form-switch a:hover::after {
            width: 100%;
        }

        /* å“åº”å¼å¸ƒå±€ä¼˜åŒ– - å¤šæ–­ç‚¹é€‚é… */
        @media (max-width: 768px) {
            :root {
                --container-width: 400px;
                --form-padding: 40px 35px;
            }
        }

        @media (max-width: 480px) {
            :root {
                --container-width: 100%;
                --form-padding: var(--mobile-form-padding);
            }

            .form-title {
                font-size: 24px;
            }

            .form-group {
                margin-bottom: 22px;
            }

            .submit-btn {
                padding: 15px;
                font-size: 15px;
            }
        }
    </style>
</head>

<body>
    <div class="form-container">
        <!-- ç™»å½•è¡¨å• -->
        <div class="form-box login-box active">
            <div class="form-header">
                <h2 class="form-title">å˜‰å†œå…¬å¸ä¿¡æ¯ç®¡ç†ç³»ç»Ÿ</h2>
                <p class="form-subtitle">è¯·é€‰æ‹©èº«ä»½å¹¶è¾“å…¥è´¦å·å¯†ç ç™»å½•</p>
            </div>

            <div class="form-group">
                <label class="form-label">ç™»å½•èº«ä»½</label>
                <select class="form-input" id="login-identity">
                    <option value="æ€»éƒ¨">æ€»éƒ¨å…¬å¸</option>
                    <option value="æ‰¹å‘ä¸­å¿ƒ">æ‰¹å‘ä¸­å¿ƒ</option>
                    <option value="ç”Ÿäº§åŸºåœ°">ç”Ÿäº§åŸºåœ°</option>
                    <option value="ä»£è´­ç‚¹">ä»£è´­ç‚¹</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">ç”¨æˆ·å</label>
                <div class="input-wrapper">
                    <input type="text" class="form-input" id="login-username" placeholder="è¯·è¾“å…¥ç”¨æˆ·åï¼ˆè‡³å°‘3ä½ï¼‰">
                </div>
                <div class="error-tip" id="login-username-error"></div>
            </div>

            <div class="form-group">
                <label class="form-label">å¯†ç </label>
                <div class="input-wrapper">
                    <input type="password" class="form-input" id="login-password" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆ6-15ä½ï¼Œè‡³å°‘ä¸¤ç§å­—ç¬¦ï¼‰">
                    <button type="button" class="password-toggle" id="login-pwd-toggle">
                        <i class="fas fa-eye-slash"></i>
                    </button>
                </div>
                <div class="error-tip" id="login-password-error"></div>
            </div>

            <button class="submit-btn" id="login-btn">ç™»å½•ç³»ç»Ÿ</button>

            <div class="form-switch">
                è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ<a href="javascript:;" id="to-register">ç«‹å³æ³¨å†Œ</a>
            </div>
        </div>

        <!-- æ³¨å†Œè¡¨å• -->
        <div class="form-box register-box">
            <div class="form-header">
                <h2 class="form-title">å˜‰å†œå…¬å¸ä¿¡æ¯ç®¡ç†ç³»ç»Ÿ</h2>
                <p class="form-subtitle">è¯·é€‰æ‹©èº«ä»½å¹¶å®Œæˆè´¦å·æ³¨å†Œ</p>
            </div>

            <div class="form-group">
                <label class="form-label">ç™»å½•èº«ä»½</label>
                <select class="form-input" id="register-identity">
                    <option value="æ€»éƒ¨">æ€»éƒ¨å…¬å¸</option>
                    <option value="æ‰¹å‘ä¸­å¿ƒ">æ‰¹å‘ä¸­å¿ƒ</option>
                    <option value="ç”Ÿäº§åŸºåœ°">ç”Ÿäº§åŸºåœ°</option>
                    <option value="ä»£è´­ç‚¹">ä»£è´­ç‚¹</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">ç”¨æˆ·å</label>
                <div class="input-wrapper">
                    <input type="text" class="form-input" id="register-username" placeholder="è¯·è®¾ç½®ç”¨æˆ·åï¼ˆè‡³å°‘3ä½ï¼‰">
                </div>
                <div class="error-tip" id="register-username-error"></div>
            </div>

            <div class="form-group">
                <label class="form-label">å¯†ç </label>
                <div class="input-wrapper">
                    <input type="password" class="form-input" id="register-password" placeholder="è¯·è®¾ç½®å¯†ç ï¼ˆ6-15ä½ï¼Œè‡³å°‘ä¸¤ç§å­—ç¬¦ï¼‰">
                    <button type="button" class="password-toggle" id="register-pwd-toggle">
                        <i class="fas fa-eye-slash"></i>
                    </button>
                </div>
                <div class="error-tip" id="register-password-error"></div>
            </div>

            <div class="form-group">
                <label class="form-label">ç¡®è®¤å¯†ç </label>
                <div class="input-wrapper">
                    <input type="password" class="form-input" id="register-repassword" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
                    <button type="button" class="password-toggle" id="register-repwd-toggle">
                        <i class="fas fa-eye-slash"></i>
                    </button>
                </div>
                <div class="error-tip" id="register-repassword-error"></div>
            </div>

            <button class="submit-btn" id="register-btn">å®Œæˆæ³¨å†Œ</button>

            <div class="form-switch">
                å·²æœ‰è´¦å·ï¼Ÿ<a href="javascript:;" id="to-login">è¿”å›ç™»å½•</a>
            </div>
        </div>
    </div>

    <script>
        // DOMå…ƒç´ è·å–ï¼ˆç»Ÿä¸€ç®¡ç†ï¼‰
        const dom = {
            loginBox: document.querySelector('.login-box'),
            registerBox: document.querySelector('.register-box'),
            toRegister: document.getElementById('to-register'),
            toLogin: document.getElementById('to-login'),
            loginBtn: document.getElementById('login-btn'),
            registerBtn: document.getElementById('register-btn'),
            // å¯†ç æ˜¾ç¤º/éšè—æŒ‰é’®
            loginPwdToggle: document.getElementById('login-pwd-toggle'),
            registerPwdToggle: document.getElementById('register-pwd-toggle'),
            registerRepwdToggle: document.getElementById('register-repwd-toggle'),
            // è¡¨å•è¾“å…¥æ¡†
            loginUsername: document.getElementById('login-username'),
            loginPassword: document.getElementById('login-password'),
            registerUsername: document.getElementById('register-username'),
            registerPassword: document.getElementById('register-password'),
            registerRepassword: document.getElementById('register-repassword'),
            // é”™è¯¯æç¤º
            loginUsernameError: document.getElementById('login-username-error'),
            loginPasswordError: document.getElementById('login-password-error'),
            registerUsernameError: document.getElementById('register-username-error'),
            registerPasswordError: document.getElementById('register-password-error'),
            registerRepasswordError: document.getElementById('register-repassword-error')
        };

        // è¡¨å•åˆ‡æ¢é€»è¾‘
        dom.toRegister.addEventListener('click', () => {
            dom.loginBox.classList.remove('active');
            dom.registerBox.classList.add('active');
            clearAllErrors();
            clearAllInputs(); // åˆ‡æ¢æ—¶æ¸…ç©ºè¾“å…¥æ¡†
        });

        dom.toLogin.addEventListener('click', () => {
            dom.registerBox.classList.remove('active');
            dom.loginBox.classList.add('active');
            clearAllErrors();
            clearAllInputs(); // åˆ‡æ¢æ—¶æ¸…ç©ºè¾“å…¥æ¡†
        });

        // å¯†ç æ˜¾ç¤º/éšè—é€šç”¨å‡½æ•°
        function togglePassword(btn, input) {
            const type = input.type === 'password' ? 'text' : 'password';
            input.type = type;
            // åˆ‡æ¢å›¾æ ‡
            const icon = btn.querySelector('i');
            icon.classList.toggle('fa-eye');
            icon.classList.toggle('fa-eye-slash');
        }

        // ç»‘å®šå¯†ç æ˜¾ç¤º/éšè—äº‹ä»¶
        dom.loginPwdToggle.addEventListener('click', () => togglePassword(dom.loginPwdToggle, dom.loginPassword));
        dom.registerPwdToggle.addEventListener('click', () => togglePassword(dom.registerPwdToggle, dom.registerPassword));
        dom.registerRepwdToggle.addEventListener('click', () => togglePassword(dom.registerRepwdToggle, dom.registerRepassword));

        // è¡¨å•éªŒè¯é€šç”¨å‡½æ•°
        const validator = {
            // ç”¨æˆ·åéªŒè¯
            username: (val) => {
                if (!val.trim()) return { valid: false, msg: 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º' };
                if (val.length < 3) return { valid: false, msg: 'ç”¨æˆ·åé•¿åº¦ä¸èƒ½å°‘äº3ä½' };
                return { valid: true, msg: '' };
            },
            // å¯†ç éªŒè¯
            password: (val) => {
                if (val.length < 6 || val.length > 15) return { valid: false, msg: 'å¯†ç é•¿åº¦å¿…é¡»ä¸º6-15ä½' };
                const hasNumber = /\d/.test(val);
                const hasLetter = /[a-zA-Z]/.test(val);
                const hasSpecial = /[^a-zA-Z0-9]/.test(val);
                const typeCount = [hasNumber, hasLetter, hasSpecial].filter(Boolean).length;
                if (typeCount < 2) return { valid: false, msg: 'å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸¤ç§å­—ç¬¦ï¼ˆæ•°å­—ã€å­—æ¯ã€ç‰¹æ®Šå­—ç¬¦ï¼‰' };
                return { valid: true, msg: '' };
            },
            // ç¡®è®¤å¯†ç éªŒè¯
            repassword: (pwd, repwd) => {
                if (!repwd.trim()) return { valid: false, msg: 'ç¡®è®¤å¯†ç ä¸èƒ½ä¸ºç©º' };
                if (pwd !== repwd) return { valid: false, msg: 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´' };
                return { valid: true, msg: '' };
            }
        };

        // æ˜¾ç¤ºé”™è¯¯æç¤º
        function showError(el, msg) {
            el.textContent = msg;
            el.classList.add('show');
        }

        // éšè—é”™è¯¯æç¤º
        function hideError(el) {
            el.textContent = '';
            el.classList.remove('show');
        }

        // æ¸…ç©ºæ‰€æœ‰é”™è¯¯æç¤º
        function clearAllErrors() {
            Object.values(dom).forEach(el => {
                if (el && el.classList && el.classList.contains('error-tip')) {
                    hideError(el);
                }
            });
        }

        // ç”Ÿæˆç”¨æˆ·å”¯ä¸€ codeï¼šUSER + yyyyMMdd + 3ä½åºå·
        function generateUserCode() {
            const date = new Date();
            const yyyy = date.getFullYear();
            const MM = String(date.getMonth() + 1).padStart(2, "0");
            const dd = String(date.getDate()).padStart(2, "0");

            return fetch('/api/getUserCountToday')
                .then(response => response.json())
                .then(data => {
                    const count = data.count + 1;
                    const index = String(count).padStart(3, "0");
                    return `USER${yyyy}${MM}${dd}${index}`;
                });
        }

        // æ¸…ç©ºæ‰€æœ‰è¾“å…¥æ¡†
        function clearAllInputs() {
            [dom.loginUsername, dom.loginPassword, dom.registerUsername, dom.registerPassword, dom.registerRepassword].forEach(input => {
                input.value = '';
                // é‡ç½®å¯†ç è¾“å…¥æ¡†ç±»å‹ä¸ºpassword
                if (input.type === 'text' && input.id.includes('password')) {
                    input.type = 'password';
                    // é‡ç½®å›¾æ ‡
                    const toggleBtn = document.querySelector(`#${input.id.replace('password', 'pwd-toggle').replace('repassword', 'repwd-toggle')}`);
                    if (toggleBtn) {
                        const icon = toggleBtn.querySelector('i');
                        icon.classList.remove('fa-eye');
                        icon.classList.add('fa-eye-slash');
                    }
                }
            });
        }

        // ç™»å½•
        dom.loginBtn.addEventListener('click', () => {
            const identity = document.getElementById('login-identity').value;
            const code = dom.loginUsername.value.trim();
            const password = dom.loginPassword.value.trim();
            let isValid = true;

            // éªŒè¯ç”¨æˆ·å
            const usernameRes = validator.username(code);
            if (!usernameRes.valid) {
                showError(dom.loginUsernameError, usernameRes.msg);
                isValid = false;
            } else {
                hideError(dom.loginUsernameError);
            }

            // éªŒè¯å¯†ç 
            const passwordRes = validator.password(password);
            if (!passwordRes.valid) {
                showError(dom.loginPasswordError, passwordRes.msg);
                isValid = false;
            } else {
                hideError(dom.loginPasswordError);
            }

            if (isValid) {
                fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        code: code,
                        password: password,
                        subsystem: identity
                    })
                })
                    .then(res => res.json())
                    .then(data => {
                        if (data.code === 200) {
                            alert(`ğŸ‰ ç™»å½•æˆåŠŸï¼\nèº«ä»½ï¼š${data.data.subsystem}\nç”¨æˆ·åï¼š${data.data.name}`);

                            // æ ¹æ®ä¸åŒå­ç³»ç»Ÿè·³è½¬ä¸åŒé¡µé¢
                            if (identity === 'ç”Ÿäº§åŸºåœ°') {
                                window.location.href = './å†œæˆ·ä¿¡æ¯è®¾ç½®-1.html'; // æ›¿æ¢ä¸ºå®é™…é¡µé¢
                            } else if (identity === 'æ‰¹å‘ä¸­å¿ƒ') {
                                window.location.href = './é¡¾å®¢ä¿¡æ¯è®¾ç½®-1.html'; // æ›¿æ¢ä¸ºå®é™…é¡µé¢
                            } else if (identity === 'ä»£è´­ç‚¹') {
                                window.location.href = './å…¬å¸æœºæ„è®¾ç½®-1.html'; // æ›¿æ¢ä¸ºå®é™…é¡µé¢
                            } else if (identity === 'æ€»éƒ¨') {
                                window.location.href = './äº§å“ä¿¡æ¯è®¾ç½®-1.html'; // æ›¿æ¢ä¸ºå®é™…é¡µé¢
                            } else {
                                alert('æœªçŸ¥å­ç³»ç»Ÿï¼Œæ— æ³•è·³è½¬');
                            }
                        } else {
                            alert(data.msg);
                        }
                    })
                    .catch(err => {
                        console.error(err);
                        alert('ç™»å½•å¤±è´¥ï¼Œç½‘ç»œé”™è¯¯');
                    });
            }
        });

        //æ³¨å†Œ
        dom.registerBtn.addEventListener('click', () => {
            const identity = document.getElementById('register-identity').value;
            const username = dom.registerUsername.value.trim();
            const password = dom.registerPassword.value.trim();
            const repassword = dom.registerRepassword.value.trim();
            let isValid = true;

            // éªŒè¯ç”¨æˆ·å
            const usernameRes = validator.username(username);
            if (!usernameRes.valid) {
                showError(dom.registerUsernameError, usernameRes.msg);
                isValid = false;
            } else {
                hideError(dom.registerUsernameError);
            }

            // éªŒè¯å¯†ç 
            const passwordRes = validator.password(password);
            if (!passwordRes.valid) {
                showError(dom.registerPasswordError, passwordRes.msg);
                isValid = false;
            } else {
                hideError(dom.registerPasswordError);
            }

            // éªŒè¯ç¡®è®¤å¯†ç 
            const repasswordRes = validator.repassword(password, repassword);
            if (!repasswordRes.valid) {
                showError(dom.registerRepasswordError, repasswordRes.msg);
                isValid = false;
            } else {
                hideError(dom.registerRepasswordError);
            }

            if (isValid) {
                // ç”Ÿæˆå”¯ä¸€ code å¹¶æäº¤æ³¨å†Œ
                generateUserCode().then(code => {
                    fetch('/api/register', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            code: code,
                            name: username,
                            password: password,
                            subsystem: identity
                        })
                    })
                        .then(res => res.json())
                        .then(data => {
                            if (data.code === 200) {
                                alert(`âœ… æ³¨å†ŒæˆåŠŸï¼\nèº«ä»½ï¼š${identity}\nç”¨æˆ·åï¼š${username}\nè¯·è¿”å›ç™»å½•`);
                                // åˆ‡æ¢å›ç™»å½•é¡µå¹¶æ¸…ç©ºè¡¨å•
                                dom.registerBox.classList.remove('active');
                                dom.loginBox.classList.add('active');
                                clearAllInputs();
                            } else {
                                alert(`âŒ æ³¨å†Œå¤±è´¥ï¼š${data.msg}`);
                            }
                        })
                        .catch(err => {
                            console.error(err);
                            alert('æ³¨å†Œå¤±è´¥ï¼Œç½‘ç»œé”™è¯¯');
                        });
                });
            }
        });


        // å®æ—¶éªŒè¯ï¼ˆè¾“å…¥æ—¶è§¦å‘ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼‰
        dom.loginUsername.addEventListener('input', () => {
            const res = validator.username(dom.loginUsername.value.trim());
            if (!res.valid) showError(dom.loginUsernameError, res.msg);
            else hideError(dom.loginUsernameError);
        });

        dom.loginPassword.addEventListener('input', () => {
            const res = validator.password(dom.loginPassword.value.trim());
            if (!res.valid) showError(dom.loginPasswordError, res.msg);
            else hideError(dom.loginPasswordError);
        });

        dom.registerUsername.addEventListener('input', () => {
            const res = validator.username(dom.registerUsername.value.trim());
            if (!res.valid) showError(dom.registerUsernameError, res.msg);
            else hideError(dom.registerUsernameError);
        });

        dom.registerPassword.addEventListener('input', () => {
            const res = validator.password(dom.registerPassword.value.trim());
            if (!res.valid) showError(dom.registerPasswordError, res.msg);
            else hideError(dom.registerPasswordError);
        });

        dom.registerRepassword.addEventListener('input', () => {
            const pwd = dom.registerPassword.value.trim();
            const repwd = dom.registerRepassword.value.trim();
            const res = validator.repassword(pwd, repwd);
            if (!res.valid) showError(dom.registerRepasswordError, res.msg);
            else hideError(dom.registerRepasswordError);
        });
    </script>
</body>

</html>